<!DOCTYPE html><HTML lang="en"><head><script charset="utf-8" src="../../../../assets/default/multidoc_injector.js" type="text/javascript"></script><script charset="utf-8" type="text/javascript">window.MULTIDOCUMENTER_ROOT_PATH = '/'</script><script charset="utf-8" src="../../../../assets/default/flexsearch.bundle.js" type="text/javascript"></script><script charset="utf-8" src="../../../../assets/default/flexsearch_integration.js" type="text/javascript"></script><meta charset="UTF-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><title>Adding a New Solar Position Algorithm · SolarPosition.jl</title><meta content="Adding a New Solar Position Algorithm · SolarPosition.jl" name="title"/><meta content="Adding a New Solar Position Algorithm · SolarPosition.jl" property="og:title"/><meta content="Adding a New Solar Position Algorithm · SolarPosition.jl" property="twitter:title"/><meta content="Documentation for SolarPosition.jl." name="description"/><meta content="Documentation for SolarPosition.jl." property="og:description"/><meta content="Documentation for SolarPosition.jl." property="twitter:description"/><meta content="https://juliaastro.org/SolarPosition/stable/guides/new-algorithm/" property="og:url"/><meta content="https://juliaastro.org/SolarPosition/stable/guides/new-algorithm/" property="twitter:url"/><link href="https://JuliaAstro.org/SolarPosition/stable/guides/new-algorithm/" rel="canonical"/><script data-outdated-warner="" src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script data-main="../../assets/documenter.js" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" data-theme-name="catppuccin-mocha" href="../../assets/themes/catppuccin-mocha.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-macchiato" href="../../assets/themes/catppuccin-macchiato.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-frappe" href="../../assets/themes/catppuccin-frappe.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="catppuccin-latte" href="../../assets/themes/catppuccin-latte.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-dark" data-theme-primary-dark="" href="../../assets/themes/documenter-dark.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" data-theme-name="documenter-light" data-theme-primary="" href="../../assets/themes/documenter-light.css" rel="stylesheet" type="text/css"/><script src="../../assets/themeswap.js"></script><link href="../../../../assets/default/multidoc.css" rel="stylesheet" type="text/css"/><link href="../../../../assets/default/flexsearch.css" rel="stylesheet" type="text/css"/></head><body><nav id="multi-page-nav"><a class="brand" href="../../../.."><img alt="home" src="../../../../assets/logo.svg"/></a><div class="hidden-on-mobile" id="nav-items"><a class="nav-link nav-item" href="../../../../home/">Home</a><div class="nav-dropdown"><button class="nav-item dropdown-label">Domain</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Solar System</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../CALCEPH/">⬤ CALCEPH</a><a class="nav-link nav-item" href="https://juliaastro.org/EphemerisSources.jl" target="_blank">⬤ EphemerisSources</a><a class="nav-link nav-item" href="https://juliaastro.org/GeneralAstrodynamics.jl" target="_blank">⬤ GeneralAstrodynamics</a><a class="nav-link nav-item" href="https://github.com/PerezHz/HORIZONS.jl?tab=readme-ov-file#horizonsjl" target="_blank">⬤ HORIZONS</a><a class="nav-link nav-item" href="https://juliaspace.github.io/SatelliteToolbox.jl/stable/" target="_blank">⬤ SatelliteToolbox</a><a class="nav-link active nav-item" href="../../../">⬤ SolarPosition</a><a class="nav-link nav-item" href="../../../../SPICE/">⬤ SPICE</a></ul></div><div class="nav-mega-column"><div class="column-header">Exoplanets</div><ul class="column-content"><a class="nav-link nav-item" href="http://JuliaHCI.github.io/ADI.jl/stable/" target="_blank">⬤ ADI</a><a class="nav-link nav-item" href="http://JuliaHCI.github.io/HCIToolbox.jl/stable/" target="_blank">⬤ HCIToolbox</a><a class="nav-link nav-item" href="../../../../Orbits/">⬤ Orbits</a><a class="nav-link nav-item" href="https://sefffal.github.io/PlanetOrbits.jl/dev/" target="_blank">⬤ PlanetOrbits</a><a class="nav-link nav-item" href="../../../../Transits/">⬤ Transits</a></ul></div><div class="nav-mega-column"><div class="column-header">Stars</div><ul class="column-content"><a class="nav-link nav-item" href="https://cgarling.github.io/BolometricCorrections.jl/stable/" target="_blank">⬤ BolometricCorrections</a><a class="nav-link nav-item" href="https://cgarling.github.io/InitialMassFunctions.jl/stable/" target="_blank">⬤ InitialMassFunctions</a><a class="nav-link nav-item" href="https://cgarling.github.io/StarFormationHistories.jl/stable/" target="_blank">⬤ StarFormationHistories</a></ul></div><div class="nav-mega-column"><div class="column-header">Galaxies and Cosmology</div><ul class="column-content"><a class="nav-link nav-item" href="https://xzackli.github.io/Bolt.jl/" target="_blank">⬤ Bolt</a><a class="nav-link nav-item" href="https://github.com/hersle/CLASS.jl?tab=readme-ov-file#classjl" target="_blank">⬤ CLASS</a><a class="nav-link nav-item" href="../../../../Cosmology/">⬤ Cosmology</a><a class="nav-link nav-item" href="../../../../DustExtinction/">⬤ DustExtinction</a><a class="nav-link nav-item" href="https://ehtjulia.github.io/ScatteringOptics.jl/stable/" target="_blank">⬤ ScatteringOptics</a><a class="nav-link nav-item" href="https://hersle.github.io/SymBoltz.jl/stable/" target="_blank">⬤ SymBoltz</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Techniques</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Photometry</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../CCDReduction/">⬤ CCDReduction</a><a class="nav-link nav-item" href="../../../../LACosmic/">⬤ LACosmic</a><a class="nav-link nav-item" href="../../../../Photometry/">⬤ Photometry</a><a class="nav-link nav-item" href="../../../../PhotometricFilters/">⬤ PhotometricFilters</a><a class="nav-link nav-item" href="../../../../PSFModels/">⬤ PSFModels</a><a class="nav-link nav-item" href="../../../../SAOImageDS9/">⬤ SAOImageDS9</a></ul></div><div class="nav-mega-column"><div class="column-header">Astrometry</div><ul class="column-content"><a class="nav-link nav-item" href="https://barrettp.github.io/Astrometry/dev" target="_blank">⬤ Astrometry</a><a class="nav-link nav-item" href="../../../../AstroTime/">⬤ AstroTime</a><a class="nav-link nav-item" href="../../../../EarthOrientation/">⬤ EarthOrientation</a><a class="nav-link nav-item" href="../../../../ERFA/">◯ ERFA</a><a class="nav-link nav-item" href="../../../../Healpix/">⬤ Healpix</a><a class="nav-link nav-item" href="../../../../Reproject/">⬤ Reproject</a><a class="nav-link nav-item" href="../../../../SkyCoords/">⬤ SkyCoords</a><a class="nav-link nav-item" href="../../../../WCS/">◯ WCS</a></ul></div><div class="nav-mega-column"><div class="column-header">Spectroscopy</div><ul class="column-content"><a class="nav-link nav-item" href="https://ajwheeler.github.io/Korg.jl/stable/" target="_blank">⬤ Korg</a><a class="nav-link nav-item" href="../../../../Spectra/">⬤ Spectra</a><a class="nav-link nav-item" href="../../../../SpectralFitting/">⬤ SpectralFitting</a></ul></div><div class="nav-mega-column"><div class="column-header">Time Series Analysis</div><ul class="column-content"><a class="nav-link nav-item" href="https://docs.juliadsp.org/stable/" target="_blank">⬤ DSP</a><a class="nav-link nav-item" href="../../../../LombScargle/">⬤ LombScargle</a><a class="nav-link nav-item" href="https://juliastats.github.io/TimeSeries.jl/stable" target="_blank">⬤ TimeSeries</a></ul></div><div class="nav-mega-column"><div class="column-header">Interferometry</div><ul class="column-content"><a class="nav-link nav-item" href="https://ptiede.github.io/Comrade.jl/stable/" target="_blank">⬤ Comrade</a><a class="nav-link nav-item" href="https://aplavin.github.io/Difmap.jl/test/examples.html" target="_blank">⬤ Difmap</a><a class="nav-link nav-item" href="https://github.com/emmt/OIFITS.jl?tab=readme-ov-file#support-for-oi-fits-data-in-julia" target="_blank">⬤ OIFITS</a><a class="nav-link nav-item" href="https://fabienbaron.github.io/OITOOLS.jl/dev" target="_blank">⬤ OITOOLS</a><a class="nav-link nav-item" href="https://ehtjulia.github.io/PolarizedTypes.jl/stable/" target="_blank">⬤ PolarizedTypes</a><a class="nav-link nav-item" href="https://aplavin.github.io/VLBIData.jl/test/examples.html" target="_blank">⬤ VLBIData</a><a class="nav-link nav-item" href="https://ehtjulia.github.io/VLBISkyModels.jl/stable/" target="_blank">⬤ VLBISkyModels</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Statistics</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Uncertainty</div><ul class="column-content"><a class="nav-link nav-item" href="https://juliaphysics.github.io/Measurements.jl/stable/" target="_blank">⬤ Measurements</a><a class="nav-link nav-item" href="https://baggepinnen.github.io/MonteCarloMeasurements.jl/stable/" target="_blank">⬤ MonteCarloMeasurements</a><a class="nav-link nav-item" href="https://baggepinnen.github.io/MonteCarloMeasurements.jl/stable/" target="_blank">⬤ Uncertain</a></ul></div><div class="nav-mega-column"><div class="column-header">Optimization</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../BoxLeastSquares/">⬤ BoxLeastSquares</a><a class="nav-link nav-item" href="http://jump.dev/JuMP.jl/" target="_blank">⬤ JuMP</a><a class="nav-link nav-item" href="https://docs.sciml.ai/NonlinearSolve/stable/" target="_blank">⬤ NonlinearSolve</a><a class="nav-link nav-item" href="https://docs.sciml.ai/Optimization/stable/" target="_blank">⬤ Optimization</a></ul></div><div class="nav-mega-column"><div class="column-header">General</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../AstroLib/">⬤ AstroLib</a><a class="nav-link nav-item" href="http://mileslucas.com/BiweightStats.jl/stable/" target="_blank">⬤ BiweightStats</a><a class="nav-link nav-item" href="https://github.com/jeff-regier/Celeste.jl/wiki/" target="_blank">⬤ Celeste</a><a class="nav-link nav-item" href="https://juliastats.org/" target="_blank">⬤ JuliaStats</a><a class="nav-link nav-item" href="https://juliastats.github.io/Distributions.jl/stable/" target="_blank">⬤ Distributions</a><a class="nav-link nav-item" href="https://ehtjulia.github.io/FastHartleyTransform.jl/stable/" target="_blank">⬤ FastHartleyTransform</a><a class="nav-link nav-item" href="https://sefffal.github.io/Octofitter.jl/dev" target="_blank">⬤ Octofitter</a></ul></div></div></div><div class="nav-dropdown"><button class="nav-item dropdown-label">Utilities</button><div class="nav-dropdown-container nav-mega-dropdown-container"><div class="nav-mega-column"><div class="column-header">Data I/O</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../ASDF2/">⬤ ASDF2</a><a class="nav-link nav-item" href="../../../../AstroImages/">⬤ AstroImages</a><a class="nav-link nav-item" href="../../../../CFITSIO/">◯ CFITSIO</a><a class="nav-link nav-item" href="https://emmt.github.io/EasyFITS.jl/dev" target="_blank">⬤ EasyFITS</a><a class="nav-link nav-item" href="../../../../FITSFiles/">⬤ FITSFiles</a><a class="nav-link nav-item" href="../../../../FITSIO/">◯ FITSIO</a><a class="nav-link nav-item" href="https://github.com/JuliaAPlavin/FixedWidthTables.jl?tab=readme-ov-file#fixedwidthtablesjl" target="_blank">⬤ FixedWidthTables</a><a class="nav-link nav-item" href="https://aplavin.github.io/SkyImages.jl/test/notebook.html" target="_blank">⬤ SkyImages</a><a class="nav-link nav-item" href="https://github.com/JuliaAPlavin/VirtualObservatory.jl?tab=readme-ov-file#virtualobservatoryjl" target="_blank">⬤ VirtualObservatory</a><a class="nav-link nav-item" href="https://github.com/JuliaAPlavin/VOTables.jl" target="_blank">⬤ VOTables</a><a class="nav-link nav-item" href="../../../../XPA/">⬤ XPA</a></ul></div><div class="nav-mega-column"><div class="column-header">Data processing</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../Astroalign/">⬤ Astroalign</a><a class="nav-link nav-item" href="../../../../BackgroundMeshes/">⬤ BackgroundMeshes</a><a class="nav-link nav-item" href="https://github.com/torrance/Casacore.jl?tab=readme-ov-file#casacorejl" target="_blank">⬤ Casacore</a><a class="nav-link nav-item" href="https://dataframes.juliadata.org/stable/" target="_blank">⬤ DataFrames</a><a class="nav-link nav-item" href="https://rafaqz.github.io/DimensionalData.jl/stable/" target="_blank">⬤ DimensionalData</a><a class="nav-link nav-item" href="https://aplavin.github.io/FlexiJoins.jl/test/examples.html" target="_blank">⬤ FlexiJoins</a><a class="nav-link nav-item" href="https://github.com/gcalderone/SortMerge.jl?tab=readme-ov-file#sortmerge" target="_blank">⬤ SortMerge</a></ul></div><div class="nav-mega-column"><div class="column-header">Data Viz</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../AstroImages/">⬤ AstroImages</a><a class="nav-link nav-item" href="https://juliaimages.github.io/ImageFiltering.jl/stable" target="_blank">⬤ ImageFiltering</a><a class="nav-link nav-item" href="https://manuelbehrendt.github.io/Mera.jl/stable/" target="_blank">⬤ Mera</a><a class="nav-link nav-item" href="https://sefffal.github.io/PairPlots.jl/dev/" target="_blank">⬤ PairPlots</a><a class="nav-link nav-item" href="https://aplavin.github.io/SkyImages.jl/test/notebook.html" target="_blank">⬤ SkyImages</a></ul></div><div class="nav-mega-column"><div class="column-header">Units/Constants</div><ul class="column-content"><a class="nav-link nav-item" href="../../../../AstroAngles/">⬤ AstroAngles</a><a class="nav-link nav-item" href="https://symbolicml.org/DynamicQuantities.jl/stable/" target="_blank">⬤ DynamicQuantities</a><a class="nav-link nav-item" href="https://juliaphysics.github.io/PhysicalConstants.jl/stable/" target="_blank">⬤ PhysicalConstants</a><a class="nav-link nav-item" href="https://painterqubits.github.io/Unitful.jl/stable" target="_blank">⬤ Unitful</a><a class="nav-link nav-item" href="../../../../UnitfulAstro/">⬤ UnitfulAstro</a></ul></div></div></div><div class="search nav-item"><input id="search-input" placeholder="Search everywhere..."/><ul class="suggestions hidden" id="search-result-container"></ul><div class="search-keybinding">/</div></div></div><button id="multidoc-toggler"><svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg></button></nav><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SolarPosition.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Guides</span><ul><li><a class="tocitem" href="../getting-started/">Getting Started</a></li><li><a class="tocitem" href="../plotting/">Plotting with Makie.jl</a></li><li><a class="tocitem" href="../parallel/">Parallel Computing with OhMyThreads.jl</a></li><li><a class="tocitem" href="../modelingtoolkit/">Building models with ModelingToolkit.jl</a></li><li class="is-active"><a class="tocitem" href="">Adding a New Solar Position Algorithm</a><ul class="internal"><li><a class="tocitem" href="#Overview"><span>Overview</span></a></li><li><a class="tocitem" href="#step-1-create-struct"><span>Step 1: Create the Algorithm Struct</span></a></li><li><a class="tocitem" href="#step-2-implement-core"><span>Step 2: Implement the Core Function</span></a></li><li><a class="tocitem" href="#step-3-handle-refraction"><span>Step 3: Handle Default Refraction</span></a></li><li><a class="tocitem" href="#step-4-export"><span>Step 4: Export the Algorithm</span></a></li><li><a class="tocitem" href="#step-5-write-tests"><span>Step 5: Write Tests</span></a></li><li><a class="tocitem" href="#step-6-document"><span>Step 6: Document Your Algorithm</span></a></li><li><a class="tocitem" href="#step-7-precommit"><span>Step 7: Run Pre-commit Checks (Recommended)</span></a></li><li><a class="tocitem" href="#Checklist"><span>Checklist</span></a></li><li><a class="tocitem" href="#Additional-Resources"><span>Additional Resources</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../reference/">API reference</a></li><li><a class="tocitem" href="../../positioning/">Solar Positioning</a></li><li><a class="tocitem" href="../../refraction/">Refraction Correction</a></li><li><a class="tocitem" href="../../deltat/">Delta T (ΔT)</a></li><li><a class="tocitem" href="../../literature/">Literature</a></li><li><a class="tocitem" href="../../contributing/">Contributing guidelines</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" href="#" id="documenter-sidebar-button"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Guides</a></li><li class="is-active"><a href="">Adding a New Solar Position Algorithm</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="">Adding a New Solar Position Algorithm</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaAstro/SolarPosition.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaAstro/SolarPosition.jl/blob/main/docs/src/guides/new-algorithm.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" href="#" id="documenter-settings-button" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" href="javascript:;" id="documenter-article-toggle-button" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="new-algorithm"><a class="docs-heading-anchor" href="#new-algorithm">Adding a New Solar Position Algorithm</a><a id="new-algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#new-algorithm" title="Permalink"></a></h1><p>This tutorial walks you through the process of adding a new solar positioning algorithm to <code>SolarPosition.jl</code>. We'll implement a simplified algorithm step by step, covering all the necessary components: the algorithm struct, core computation, refraction handling, exports, and tests.</p><h2 id="Overview"><a class="docs-heading-anchor" href="#Overview">Overview</a><a id="Overview-1"></a><a class="docs-heading-anchor-permalink" href="#Overview" title="Permalink"></a></h2><p>Adding a new algorithm involves these steps:</p><ol><li><a href="#step-1-create-struct"><strong>Create the algorithm struct</strong></a> - Define a type that subtypes <a href="../../reference/#SolarPosition.Positioning.SolarAlgorithm"><code>SolarAlgorithm</code></a>.</li><li><a href="#step-2-implement-core"><strong>Implement the core function</strong></a> - Write <code>_solar_position</code> for your algorithm.</li><li><a href="#step-3-handle-refraction"><strong>Handle refraction</strong></a> - Define how your algorithm interacts with <code>DefaultRefraction</code>.</li><li><a href="#step-4-export"><strong>Export the algorithm</strong></a> - Make it available to users.</li><li><a href="#step-5-write-tests"><strong>Write tests</strong></a> - Validate correctness against reference values.</li><li><a href="#step-6-document"><strong>Document</strong></a> - Add docstrings and update documentation.</li><li><a href="#step-7-precommit"><strong>Run pre-commit checks</strong></a> - Ensure code quality and formatting.</li></ol><div class="admonition is-info" id="Underscore-9f9a779663fa3cf3"><header class="admonition-header">Underscore<a class="admonition-anchor" href="#Underscore-9f9a779663fa3cf3" title="Permalink"></a></header><div class="admonition-body"><p>Note the underscore prefix in <code>_solar_position</code>. This function is internal and should not be called directly by users. Instead, they will use the public <a href="../../reference/#SolarPosition.Positioning.solar_position"><code>solar_position</code></a> function, which dispatches to your implementation based on the algorithm type struct.</p></div></div><h2 id="step-1-create-struct"><a class="docs-heading-anchor" href="#step-1-create-struct">Step 1: Create the Algorithm Struct</a><a id="step-1-create-struct-1"></a><a class="docs-heading-anchor-permalink" href="#step-1-create-struct" title="Permalink"></a></h2><p>Create a new file in <code>src/Positioning/</code> for your algorithm. For this example, we'll create a simplified algorithm called <code>SimpleAlgorithm</code>.</p><p>The struct must:</p><ul><li>Subtype <a href="../../reference/#SolarPosition.Positioning.SolarAlgorithm"><code>SolarAlgorithm</code></a></li><li>Include a docstring with <code>TYPEDEF</code> and <code>TYPEDFIELDS</code> macros</li><li>Document accuracy and provide literature references</li></ul><pre><code class="language-julia hljs"># src/Positioning/simple.jl

"""
    \$(TYPEDEF)

Simple solar position algorithm for demonstration purposes.

This algorithm uses basic spherical trigonometry to compute solar positions.
It is provided as a teaching example and is NOT suitable for production use.

# Accuracy
This is a simplified algorithm with limited accuracy (±1°).

# Literature
Based on basic solar geometry principles.

# Fields
\$(TYPEDFIELDS)
"""
struct SimpleAlgorithm &lt;: SolarAlgorithm
    "Optional configuration parameter"
    param::Float64
end

# Provide a default constructor
SimpleAlgorithm() = SimpleAlgorithm(1.0)</code></pre><h2 id="step-2-implement-core"><a class="docs-heading-anchor" href="#step-2-implement-core">Step 2: Implement the Core Function</a><a id="step-2-implement-core-1"></a><a class="docs-heading-anchor-permalink" href="#step-2-implement-core" title="Permalink"></a></h2><p>The core of any algorithm is the <code>_solar_position</code> function. This function:</p><ul><li>Takes an <a href="../../reference/#SolarPosition.Positioning.Observer"><code>Observer</code></a>, <code>DateTime</code>, and your algorithm type</li><li>Returns a <a href="../../reference/#SolarPosition.Positioning.SolPos"><code>SolPos{T}</code></a> with azimuth, elevation, and zenith angles</li><li>Should be type-stable and performant</li></ul><p>Here's the basic structure:</p><pre><code class="language-julia hljs">function _solar_position(obs::Observer{T}, dt::DateTime, alg::SimpleAlgorithm) where {T}
    # 1. Convert datetime to Julian date
    jd = datetime2julian(dt)

    # 2. Calculate days since J2000.0 epoch
    n = jd - 2451545.0

    # 3. Compute solar coordinates (declination, hour angle, etc.)
    # ... your algorithm's calculations here ...

    # 4. Calculate local horizontal coordinates
    # ... azimuth and elevation calculations ...

    # 5. Return the result
    return SolPos{T}(azimuth_deg, elevation_deg, zenith_deg)
end</code></pre><h3 id="Key-Implementation-Notes"><a class="docs-heading-anchor" href="#Key-Implementation-Notes">Key Implementation Notes</a><a id="Key-Implementation-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Key-Implementation-Notes" title="Permalink"></a></h3><ol><li><p><strong>Use helper functions</strong> from <code>utils.jl</code>:</p><ul><li><code>fractional_hour(dt)</code> - Convert time to decimal hours</li><li><code>deg2rad(x)</code> / <code>rad2deg(x)</code> - Angle conversions</li></ul></li><li><p><strong>Observer properties</strong> are pre-computed for efficiency:</p><ul><li><code>obs.latitude</code>, <code>obs.longitude</code>, <code>obs.altitude</code> - Input values</li><li><code>obs.latitude_rad</code>, <code>obs.longitude_rad</code> - Radians versions</li><li><code>obs.sin_lat</code>, <code>obs.cos_lat</code> - Precomputed trigonometric values</li></ul></li><li><p><strong>Type parameter <code>T</code></strong> ensures numerical precision is preserved from the <code>Observer</code></p></li><li><p><strong>Angle conventions</strong>:</p><ul><li>Azimuth: 0° = North, positive clockwise, range [0°, 360°]</li><li>Elevation: angle above horizon, range [-90°, 90°]</li><li>Zenith: 90° - elevation, range [0°, 180°]</li></ul></li></ol><h2 id="step-3-handle-refraction"><a class="docs-heading-anchor" href="#step-3-handle-refraction">Step 3: Handle Default Refraction</a><a id="step-3-handle-refraction-1"></a><a class="docs-heading-anchor-permalink" href="#step-3-handle-refraction" title="Permalink"></a></h2><p>Each algorithm must specify how it handles <code>DefaultRefraction</code>. There are two common patterns:</p><h3 id="Pattern-A:-No-Refraction-by-Default-(like-[PSA](@ref-SolarPosition.Positioning.PSA))"><a class="docs-heading-anchor" href="#Pattern-A:-No-Refraction-by-Default-(like-[PSA](@ref-SolarPosition.Positioning.PSA))">Pattern A: No Refraction by Default (like </a><a href="../../positioning/#SolarPosition.Positioning.PSA"><code>PSA</code></a>)<a id="Pattern-A:-No-Refraction-by-Default-(like-[PSA](@ref-SolarPosition.Positioning.PSA))-1"></a><a class="docs-heading-anchor-permalink" href="#Pattern-A:-No-Refraction-by-Default-(like-[PSA](@ref-SolarPosition.Positioning.PSA))" title="Permalink"></a></h3><p>If your algorithm should NOT apply refraction by default:</p><pre><code class="language-julia hljs">function _solar_position(obs, dt, alg::SimpleAlgorithm, ::DefaultRefraction)
    return _solar_position(obs, dt, alg, NoRefraction())
end

# Return type for DefaultRefraction
result_type(::Type{SimpleAlgorithm}, ::Type{DefaultRefraction}, ::Type{T}) where {T} =
    SolPos{T}</code></pre><h3 id="Pattern-B:-Apply-Refraction-by-Default-(like-[NOAA](@ref-SolarPosition.Positioning.NOAA))"><a class="docs-heading-anchor" href="#Pattern-B:-Apply-Refraction-by-Default-(like-[NOAA](@ref-SolarPosition.Positioning.NOAA))">Pattern B: Apply Refraction by Default (like </a><a href="../../positioning/#SolarPosition.Positioning.NOAA"><code>NOAA</code></a>)<a id="Pattern-B:-Apply-Refraction-by-Default-(like-[NOAA](@ref-SolarPosition.Positioning.NOAA))-1"></a><a class="docs-heading-anchor-permalink" href="#Pattern-B:-Apply-Refraction-by-Default-(like-[NOAA](@ref-SolarPosition.Positioning.NOAA))" title="Permalink"></a></h3><p>If your algorithm should apply a specific refraction model by default:</p><pre><code class="language-julia hljs">using ..Refraction: HUGHES, DefaultRefraction

function _solar_position(obs, dt, alg::SimpleAlgorithm, ::DefaultRefraction)
    return _solar_position(obs, dt, alg, HUGHES())
end

# Return type for DefaultRefraction
result_type(::Type{SimpleAlgorithm}, ::Type{DefaultRefraction}, ::Type{T}) where {T} =
    ApparentSolPos{T}</code></pre><p>The <code>result_type</code> function tells the system what return type to expect, enabling type-stable code for vectorized operations.</p><h2 id="step-4-export"><a class="docs-heading-anchor" href="#step-4-export">Step 4: Export the Algorithm</a><a id="step-4-export-1"></a><a class="docs-heading-anchor-permalink" href="#step-4-export" title="Permalink"></a></h2><p>After implementing your algorithm, you need to export it so users can access it.</p><h3 id="4.1-Include-in-Positioning-Module"><a class="docs-heading-anchor" href="#4.1-Include-in-Positioning-Module">4.1 Include in Positioning Module</a><a id="4.1-Include-in-Positioning-Module-1"></a><a class="docs-heading-anchor-permalink" href="#4.1-Include-in-Positioning-Module" title="Permalink"></a></h3><p>Edit <code>src/Positioning/Positioning.jl</code> to include your new file:</p><pre><code class="language-julia hljs"># Near the bottom of the file, with other includes
include("utils.jl")
include("deltat.jl")
include("psa.jl")
include("noaa.jl")
include("walraven.jl")
include("usno.jl")
include("spa.jl")
include("simple.jl")  # Add your new file

# Add to the export list
export Observer,
    PSA,
    NOAA,
    Walraven,
    USNO,
    SPA,
    SimpleAlgorithm,  # Add your algorithm
    solar_position,
    solar_position!,
    SolPos,
    ApparentSolPos,
    SPASolPos</code></pre><h3 id="4.2-Export-from-Main-Module"><a class="docs-heading-anchor" href="#4.2-Export-from-Main-Module">4.2 Export from Main Module</a><a id="4.2-Export-from-Main-Module-1"></a><a class="docs-heading-anchor-permalink" href="#4.2-Export-from-Main-Module" title="Permalink"></a></h3><p>Edit <code>src/SolarPosition.jl</code> to re-export your algorithm:</p><pre><code class="language-julia hljs">using .Positioning:
    Observer, PSA, NOAA, Walraven, USNO, SPA, SimpleAlgorithm, solar_position, solar_position!

# ... later in exports ...
export PSA, NOAA, Walraven, USNO, SPA, SimpleAlgorithm</code></pre><h2 id="step-5-write-tests"><a class="docs-heading-anchor" href="#step-5-write-tests">Step 5: Write Tests</a><a id="step-5-write-tests-1"></a><a class="docs-heading-anchor-permalink" href="#step-5-write-tests" title="Permalink"></a></h2><p>Create a test file following the naming convention <code>test/test-simple.jl</code>.</p><div class="admonition is-warning" id="Generating-Validation-Data-6d956d578bfd4b92"><header class="admonition-header">Generating Validation Data<a class="admonition-anchor" href="#Generating-Validation-Data-6d956d578bfd4b92" title="Permalink"></a></header><div class="admonition-body"><p>It is required to validate your algorithm against known reference values. You can use a reference implementation of your algorithm (if available) or compare against trusted solar position calculators. Store these reference values in your test file and use <code>@test</code> statements to ensure your implementation matches them. See the existing test files like <code>test/test-psa.jl</code> for examples of how to structure these tests.</p></div></div><h3 id="Running-Tests"><a class="docs-heading-anchor" href="#Running-Tests">Running Tests</a><a id="Running-Tests-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Tests" title="Permalink"></a></h3><p>Tests are automatically discovered by <code>runtests.jl</code>. Run them with:</p><pre><code class="language-bash hljs">julia --project=. -e 'using Pkg; Pkg.test()'</code></pre><p>Or from the Julia REPL:</p><pre><code class="language-julia hljs">using Pkg
Pkg.activate(".")
Pkg.test()</code></pre><h2 id="step-6-document"><a class="docs-heading-anchor" href="#step-6-document">Step 6: Document Your Algorithm</a><a id="step-6-document-1"></a><a class="docs-heading-anchor-permalink" href="#step-6-document" title="Permalink"></a></h2><h3 id="Add-to-Documentation-Pages"><a class="docs-heading-anchor" href="#Add-to-Documentation-Pages">Add to Documentation Pages</a><a id="Add-to-Documentation-Pages-1"></a><a class="docs-heading-anchor-permalink" href="#Add-to-Documentation-Pages" title="Permalink"></a></h3><p>Update <code>docs/src/positioning.md</code> to include your algorithm in the algorithm reference section.</p><h3 id="Add-Literature-References"><a class="docs-heading-anchor" href="#Add-Literature-References">Add Literature References</a><a id="Add-Literature-References-1"></a><a class="docs-heading-anchor-permalink" href="#Add-Literature-References" title="Permalink"></a></h3><p>If your algorithm is based on published work, add the reference to <code>docs/src/refs.bib</code>:</p><pre><code class="language-bibtex hljs">@article{YourReference,
    author = {Author Name},
    title = {Algorithm Title},
    journal = {Journal Name},
    year = {2024},
    volume = {1},
    pages = {1-10}
}</code></pre><p>Then cite it in your docstring using <code>[YourReference](@cite)</code>.</p><h2 id="step-7-precommit"><a class="docs-heading-anchor" href="#step-7-precommit">Step 7: Run Pre-commit Checks (Recommended)</a><a id="step-7-precommit-1"></a><a class="docs-heading-anchor-permalink" href="#step-7-precommit" title="Permalink"></a></h2><p>Before submitting a pull request, it's recommended to run pre-commit hooks locally to catch formatting and linting issues early. This saves time during code review and ensures your code meets the project's quality standards. The pre-commit configuration is defined in the <code>.pre-commit-config.yaml</code> file at the root of the repository.</p><div class="admonition is-info" id="CI-Runs-Pre-commit-d5e38e3fb3b1e59a"><header class="admonition-header">CI Runs Pre-commit<a class="admonition-anchor" href="#CI-Runs-Pre-commit-d5e38e3fb3b1e59a" title="Permalink"></a></header><div class="admonition-body"><p>Even if you skip this step locally, GitHub CI will automatically run pre-commit checks on your pull request. However, running them locally first helps you catch and fix issues before pushing.</p></div></div><h3 id="Installing-Pre-commit"><a class="docs-heading-anchor" href="#Installing-Pre-commit">Installing Pre-commit</a><a id="Installing-Pre-commit-1"></a><a class="docs-heading-anchor-permalink" href="#Installing-Pre-commit" title="Permalink"></a></h3><pre><code class="language-bash hljs"># Install pre-commit (requires Python)
pip install pre-commit

# Install the git hooks (run once per clone)
pre-commit install</code></pre><h3 id="Running-Pre-commit"><a class="docs-heading-anchor" href="#Running-Pre-commit">Running Pre-commit</a><a id="Running-Pre-commit-1"></a><a class="docs-heading-anchor-permalink" href="#Running-Pre-commit" title="Permalink"></a></h3><pre><code class="language-bash hljs"># Run all hooks on all files
pre-commit run --all-files

# Or run on staged files only
pre-commit run</code></pre><p>Pre-commit runs several checks including:</p><ul><li><strong>JuliaFormatter</strong> - Ensures consistent code formatting</li><li><strong>ExplicitImports</strong> - Checks for explicit imports</li><li><strong>markdownlint</strong> - Lints markdown files</li><li><strong>typos</strong> - Catches common spelling mistakes</li></ul><p>If any checks fail, fix the issues and run pre-commit again until all checks pass.</p><h2 id="Checklist"><a class="docs-heading-anchor" href="#Checklist">Checklist</a><a id="Checklist-1"></a><a class="docs-heading-anchor-permalink" href="#Checklist" title="Permalink"></a></h2><p>Before submitting your algorithm for review, ensure you've completed the following:</p><table><tbody><tr><th style="text-align: right">Task</th><th style="text-align: right">Description</th></tr><tr><td style="text-align: right">Algorithm struct</td><td style="text-align: right">Subtypes <a href="../../reference/#SolarPosition.Positioning.SolarAlgorithm"><code>SolarAlgorithm</code></a></td></tr><tr><td style="text-align: right">Docstring</td><td style="text-align: right">Includes <code>TYPEDEF</code>, <code>TYPEDFIELDS</code>, accuracy, and references</td></tr><tr><td style="text-align: right"><code>_solar_position</code></td><td style="text-align: right">Function implemented with correct signature</td></tr><tr><td style="text-align: right">Default refraction</td><td style="text-align: right">Handling defined for <a href="../../refraction/#SolarPosition.Refraction.DefaultRefraction"><code>DefaultRefraction</code></a></td></tr><tr><td style="text-align: right"><code>result_type</code></td><td style="text-align: right">Function defined for <a href="../../refraction/#SolarPosition.Refraction.DefaultRefraction"><code>DefaultRefraction</code></a></td></tr><tr><td style="text-align: right">Export</td><td style="text-align: right">Algorithm exported from both modules</td></tr><tr><td style="text-align: right">Tests</td><td style="text-align: right">Cover basic functionality, refraction, vectors, and edge cases</td></tr><tr><td style="text-align: right">Test coverage</td><td style="text-align: right">Ensure tests cover all new code paths</td></tr><tr><td style="text-align: right">Pre-commit</td><td style="text-align: right">Checks pass (recommended locally, required in CI)</td></tr><tr><td style="text-align: right">Documentation</td><td style="text-align: right">Update algorithm lists in <code>positioning.md</code>, <code>README.md</code>, and <code>refraction.md</code></td></tr><tr><td style="text-align: right">Literature</td><td style="text-align: right">References added to <code>refs.bib</code> and cited in docstrings</td></tr></tbody></table><h2 id="Additional-Resources"><a class="docs-heading-anchor" href="#Additional-Resources">Additional Resources</a><a id="Additional-Resources-1"></a><a class="docs-heading-anchor-permalink" href="#Additional-Resources" title="Permalink"></a></h2><ul><li>See existing implementations in <code>src/Positioning/</code> for reference:<ul><li><code>psa.jl</code> - Simple algorithm with no default refraction (<a href="../../positioning/#SolarPosition.Positioning.PSA"><code>PSA</code></a>)</li><li><code>noaa.jl</code> - Algorithm with default <a href="../../refraction/#SolarPosition.Refraction.HUGHES"><code>HUGHES</code></a> refraction (<a href="../../positioning/#SolarPosition.Positioning.NOAA"><code>NOAA</code></a>)</li><li><code>spa.jl</code> - Complex algorithm with additional output fields (<a href="../../positioning/#SolarPosition.Positioning.SPA"><code>SPA</code></a>)</li></ul></li><li>Check the <a href="../../contributing/#contributing">Contributing Guidelines</a> for general contribution workflow</li><li>Review the <a href="../../positioning/#solar-positioning-algorithms">Solar Positioning Algorithms</a> page for context</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../modelingtoolkit/">« Building models with ModelingToolkit.jl</a><a class="docs-footer-nextpage" href="../../reference/">API reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label></p><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div><p></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Saturday 29 November 2025 18:00">Saturday 29 November 2025</span>. Using Julia version 1.12.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></HTML>