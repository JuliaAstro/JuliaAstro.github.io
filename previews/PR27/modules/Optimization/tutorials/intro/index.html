<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic usage · JuliaAstro</title><link rel="canonical" href="https://juliaastro.github.io/modules/Optimization/tutorials/intro/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="JuliaAstro logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuliaAstro</span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../../../tutorials/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../tutorials/jwst-image-scale-bar/">JWST image with scale bar</a></li><li><a class="tocitem" href="../../../../tutorials/tabular-data/">Working with tabular data</a></li><li><a class="tocitem" href="../../../../tutorials/curve-fit/">Curve Fitting</a></li></ul></li></ul></li><li><span class="tocitem">Time, Coordinates, &amp; Units</span><ul><li><a class="tocitem" href="../../../../highlevels/timecoords/">Time, Coordinates, &amp; Units Overview</a></li><li><a class="tocitem" href="../../../AstroAngles/">AstroAngles</a></li></ul></li><li><span class="tocitem">Images</span><ul><li><a class="tocitem" href="../../../../highlevels/images/">Images Overview</a></li></ul></li><li><span class="tocitem">Data I/O</span><ul><li><a class="tocitem" href="../../../../highlevels/dataio/">Data I/O Overview</a></li><li><a class="tocitem" href="../../../CasaCore/">CasaCore</a></li><li><a class="tocitem" href="../../../OIFITS/">OIFITS</a></li><li><a class="tocitem" href="../../../VLBIData/">VLBIData</a></li><li><a class="tocitem" href="../../../Difmap/">Difmap</a></li></ul></li><li><span class="tocitem">Cosmology</span><ul><li><a class="tocitem" href="../../../../highlevels/cosmology/">Cosmology Overview</a></li></ul></li><li><span class="tocitem">Orbits &amp; Emphemerides</span><ul><li><a class="tocitem" href="../../../../highlevels/orb-ephem/">Orbits &amp; Ephemerides Overview</a></li><li><a class="tocitem" href="../../../PlanetOrbits/">PlanetOrbits</a></li></ul></li><li><span class="tocitem">Numerical Utilities</span><ul><li><a class="tocitem" href="../../../../highlevels/numerical-utils/">Numerical Utilities Overview</a></li><li><input class="collapse-toggle" id="menuitem-8-2" type="checkbox" checked/><label class="tocitem" for="menuitem-8-2"><span class="docs-label">Optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../">Optimization.jl: A Unified Optimization Package</a></li><li><input class="collapse-toggle" id="menuitem-8-2-2" type="checkbox" checked/><label class="tocitem" for="menuitem-8-2-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li class="is-active"><a class="tocitem" href>Basic usage</a><ul class="internal"><li><a class="tocitem" href="#Controlling-Gradient-Calculations-(Automatic-Differentiation)"><span>Controlling Gradient Calculations (Automatic Differentiation)</span></a></li><li><a class="tocitem" href="#Setting-Box-Constraints"><span>Setting Box Constraints</span></a></li></ul></li><li><a class="tocitem" href="../rosenbrock/">Solving the Rosenbrock Problem in &gt;10 Ways</a></li><li><a class="tocitem" href="../minibatch/">Data Iterators and Minibatching</a></li><li><a class="tocitem" href="../symbolic/">Symbolic Problem Building with ModelingToolkit</a></li><li><a class="tocitem" href="../constraints/">Using Equality and Inequality Constraints</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2-3" type="checkbox"/><label class="tocitem" for="menuitem-8-2-3"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../API/optimization_problem/">Defining OptimizationProblems</a></li><li><a class="tocitem" href="../../API/optimization_function/">OptimizationFunction</a></li><li><a class="tocitem" href="../../API/solve/">Common Solver Options (Solve Keyword Arguments)</a></li><li><a class="tocitem" href="../../API/modelingtoolkit/">ModelingToolkit Integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2-4" type="checkbox"/><label class="tocitem" for="menuitem-8-2-4"><span class="docs-label">Optimizer Packages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../optimization_packages/blackboxoptim/">BlackBoxOptim.jl</a></li><li><a class="tocitem" href="../../optimization_packages/cmaevolutionstrategy/">CMAEvolutionStrategy.jl</a></li><li><a class="tocitem" href="../../optimization_packages/evolutionary/">Evolutionary.jl</a></li><li><a class="tocitem" href="../../optimization_packages/flux/">Flux.jl</a></li><li><a class="tocitem" href="../../optimization_packages/gcmaes/">GCMAES.jl</a></li><li><a class="tocitem" href="../../optimization_packages/mathoptinterface/">MathOptInterface.jl</a></li><li><a class="tocitem" href="../../optimization_packages/multistartoptimization/">MultistartOptimization.jl</a></li><li><a class="tocitem" href="../../optimization_packages/metaheuristics/">Metaheuristics.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nomad/">NOMAD.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nlopt/">NLopt.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nonconvex/">Nonconvex.jl</a></li><li><a class="tocitem" href="../../optimization_packages/optim/">Optim.jl</a></li><li><a class="tocitem" href="../../optimization_packages/optimisers/">Optimisers.jl</a></li><li><a class="tocitem" href="../../optimization_packages/quaddirect/">QuadDIRECT.jl</a></li></ul></li></ul></li></ul></li><li><span class="tocitem">Statistics</span><ul><li><a class="tocitem" href="../../../../highlevels/stats/">Statistics Overview</a></li><li><a class="tocitem" href="../../../PairPlots/">PairPlots</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Numerical Utilities</a></li><li><a class="is-disabled">Optimization</a></li><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Basic usage</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Basic usage</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaAstro/JuliaAstro.github.io/blob/master/docs/src/modules/Optimization/tutorials/intro.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-usage"><a class="docs-heading-anchor" href="#Basic-usage">Basic usage</a><a id="Basic-usage-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-usage" title="Permalink"></a></h1><p>In this tutorial we introduce the basics of Optimization.jl by showing how to easily mix local optimizers from Optim.jl and global optimizers from BlackBoxOptim.jl on the Rosenbrock equation. The simplest copy-pasteable code to get started is the following:</p><pre><code class="language-"># Import the package and define the problem to optimize
using Optimization
rosenbrock(u,p) =  (p[1] - u[1])^2 + p[2] * (u[2] - u[1]^2)^2
u0 = zeros(2)
p  = [1.0,100.0]

prob = OptimizationProblem(rosenbrock,u0,p)

# Import a solver package and solve the optimization problem
using OptimizationOptimJL
sol = solve(prob,NelderMead())

# Import a different solver package and solve the optimization problem a different way
using OptimizationBBO
prob = OptimizationProblem(rosenbrock, u0, p, lb = [-1.0,-1.0], ub = [1.0,1.0])
sol = solve(prob,BBO_adaptive_de_rand_1_bin_radiuslimited())</code></pre><p>Notice that Optimization.jl is the core glue package that holds all of the common pieces, but to solve the equations we need to use a solver package. Here, OptimizationOptimJL is for <a href="https://github.com/JuliaNLSolvers/Optim.jl">Optim.jl</a> and OptimizationBBO is for <a href="https://github.com/robertfeldt/BlackBoxOptim.jl">BlackBoxOptim.jl</a>.</p><p>The output of the first optimization task (with the <code>NelderMead()</code> algorithm) is given below:</p><pre><code class="language-">sol = solve(prob,NelderMead())</code></pre><p>The solution from the original solver can always be obtained via <code>original</code>:</p><pre><code class="language-">sol.original</code></pre><h2 id="Controlling-Gradient-Calculations-(Automatic-Differentiation)"><a class="docs-heading-anchor" href="#Controlling-Gradient-Calculations-(Automatic-Differentiation)">Controlling Gradient Calculations (Automatic Differentiation)</a><a id="Controlling-Gradient-Calculations-(Automatic-Differentiation)-1"></a><a class="docs-heading-anchor-permalink" href="#Controlling-Gradient-Calculations-(Automatic-Differentiation)" title="Permalink"></a></h2><p>Notice that both of the above methods were derivative-free methods, and thus no gradients were required to do the optimization. However, in many cases first order optimization (i.e. using gradients) is much more efficient. Defining gradients can be done in two ways. One way is to manually provide a gradient definition in the <code>OptimizationFunction</code> constructor. However, the more convenient way to obtain gradients is to provide an AD backend type. </p><p>For example, let&#39;s now use the OptimizationOptimJL <code>BFGS</code> method to solve the same problem. We will import the forward-mode automatic differentiation library (<code>using ForwardDiff</code>) and then specify in the <code>OptimizationFunction</code> to automatically construct the derivative functions using ForwardDiff.jl. This looks like:</p><pre><code class="language-">using ForwardDiff
optf = OptimizationFunction(rosenbrock, Optimization.AutoForwardDiff())
prob = OptimizationProblem(optf, u0, p)
sol = solve(prob,BFGS())</code></pre><p>We can inspect the <code>original</code> to see the statistics on the number of steps  required and gradients computed:</p><pre><code class="language-">sol.original</code></pre><p>Sure enough, it&#39;s a lot less than the derivative-free methods!</p><p>However, the compute cost of forward-mode automatic differentiation scales via the number of inputs, and thus as our optimization problem grows large it slow down. To counteract this, for larger optimization problems (&gt;100 state variables) one normally would want to use reverse-mode automatic differentiation. One common choice for reverse-mode automatic differentiation is Zygote.jl. We can demonstrate this via:</p><pre><code class="language-">using Zygote
optf = OptimizationFunction(rosenbrock, Optimization.AutoZygote())
prob = OptimizationProblem(optf, u0, p)
sol = solve(prob,BFGS())</code></pre><h2 id="Setting-Box-Constraints"><a class="docs-heading-anchor" href="#Setting-Box-Constraints">Setting Box Constraints</a><a id="Setting-Box-Constraints-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-Box-Constraints" title="Permalink"></a></h2><p>In many cases one knows the potential bounds on the solution values. In Optimization.jl, these can be supplied as the <code>lb</code> and <code>ub</code> arguments for the lower bounds and upper bounds respectively, supplying a vector of values with one per state variable. Let&#39;s now do our gradient-based optimization with box constraints by rebuilding the OptimizationProblem:</p><pre><code class="language-">prob = OptimizationProblem(optf, u0, p, lb = [-1.0,-1.0], ub = [1.0,1.0])
sol = solve(prob,BFGS())</code></pre><p>For more information on handling constraints, in particular equality and inequality constraints, take a look at the <a href="../constraints/#constraints">constraints tutorial</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../">« Optimization.jl: A Unified Optimization Package</a><a class="docs-footer-nextpage" href="../rosenbrock/">Solving the Rosenbrock Problem in &gt;10 Ways »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 8 August 2022 15:51">Monday 8 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
