<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>PlanetOrbits · JuliaAstro</title><link rel="canonical" href="https://juliaastro.github.io/modules/PlanetOrbits/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="JuliaAstro logo"/></a><div class="docs-package-name"><span class="docs-autofit">JuliaAstro</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/jwst-image-scale-bar/">JWST image with scale bar</a></li><li><a class="tocitem" href="../../tutorials/tabular-data/">Working with tabular data</a></li><li><a class="tocitem" href="../../tutorials/curve-fit/">Curve Fitting</a></li></ul></li></ul></li><li><span class="tocitem">Time, Coordinates, &amp; Units</span><ul><li><a class="tocitem" href="../../highlevels/timecoords/">Time, Coordinates, &amp; Units Overview</a></li><li><a class="tocitem" href="../AstroAngles/">AstroAngles</a></li></ul></li><li><span class="tocitem">Images</span><ul><li><a class="tocitem" href="../../highlevels/images/">Images Overview</a></li></ul></li><li><span class="tocitem">Data I/O</span><ul><li><a class="tocitem" href="../../highlevels/dataio/">Data I/O Overview</a></li><li><a class="tocitem" href="../CasaCore/">CasaCore</a></li><li><a class="tocitem" href="../OIFITS/">OIFITS</a></li><li><a class="tocitem" href="../VLBIData/">VLBIData</a></li><li><a class="tocitem" href="../Difmap/">Difmap</a></li></ul></li><li><span class="tocitem">Cosmology</span><ul><li><a class="tocitem" href="../../highlevels/cosmology/">Cosmology Overview</a></li></ul></li><li><span class="tocitem">Orbits &amp; Emphemerides</span><ul><li><a class="tocitem" href="../../highlevels/orb-ephem/">Orbits &amp; Ephemerides Overview</a></li><li class="is-active"><a class="tocitem" href>PlanetOrbits</a><ul class="internal"><li><a class="tocitem" href="#Usage"><span>Usage</span></a></li><li><a class="tocitem" href="#Units-and-Conventions"><span>Units &amp; Conventions</span></a></li><li><a class="tocitem" href="#Image-Warping"><span>Image Warping</span></a></li><li><a class="tocitem" href="#Makie-Recipe"><span>Makie Recipe</span></a></li><li><a class="tocitem" href="#Installation"><span>Installation</span></a></li><li><a class="tocitem" href="#Performance"><span>Performance</span></a></li><li><a class="tocitem" href="#Numerical-Derivatives"><span>Numerical Derivatives</span></a></li><li><a class="tocitem" href="#Calculating-orbits-on-a-GPU"><span>Calculating orbits on a GPU</span></a></li></ul></li></ul></li><li><span class="tocitem">Numerical Utilities</span><ul><li><a class="tocitem" href="../../highlevels/numerical-utils/">Numerical Utilities Overview</a></li><li><input class="collapse-toggle" id="menuitem-8-2" type="checkbox"/><label class="tocitem" for="menuitem-8-2"><span class="docs-label">Optimization</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Optimization/">Optimization.jl: A Unified Optimization Package</a></li><li><input class="collapse-toggle" id="menuitem-8-2-2" type="checkbox"/><label class="tocitem" for="menuitem-8-2-2"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Optimization/tutorials/intro/">Basic usage</a></li><li><a class="tocitem" href="../Optimization/tutorials/rosenbrock/">Solving the Rosenbrock Problem in &gt;10 Ways</a></li><li><a class="tocitem" href="../Optimization/tutorials/minibatch/">Data Iterators and Minibatching</a></li><li><a class="tocitem" href="../Optimization/tutorials/symbolic/">Symbolic Problem Building with ModelingToolkit</a></li><li><a class="tocitem" href="../Optimization/tutorials/constraints/">Using Equality and Inequality Constraints</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2-3" type="checkbox"/><label class="tocitem" for="menuitem-8-2-3"><span class="docs-label">API</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Optimization/API/optimization_problem/">Defining OptimizationProblems</a></li><li><a class="tocitem" href="../Optimization/API/optimization_function/">OptimizationFunction</a></li><li><a class="tocitem" href="../Optimization/API/solve/">Common Solver Options (Solve Keyword Arguments)</a></li><li><a class="tocitem" href="../Optimization/API/modelingtoolkit/">ModelingToolkit Integration</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-8-2-4" type="checkbox"/><label class="tocitem" for="menuitem-8-2-4"><span class="docs-label">Optimizer Packages</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../Optimization/optimization_packages/blackboxoptim/">BlackBoxOptim.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/cmaevolutionstrategy/">CMAEvolutionStrategy.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/evolutionary/">Evolutionary.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/flux/">Flux.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/gcmaes/">GCMAES.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/mathoptinterface/">MathOptInterface.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/multistartoptimization/">MultistartOptimization.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/metaheuristics/">Metaheuristics.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/nomad/">NOMAD.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/nlopt/">NLopt.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/nonconvex/">Nonconvex.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/optim/">Optim.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/optimisers/">Optimisers.jl</a></li><li><a class="tocitem" href="../Optimization/optimization_packages/quaddirect/">QuadDIRECT.jl</a></li></ul></li></ul></li></ul></li><li><span class="tocitem">Statistics</span><ul><li><a class="tocitem" href="../../highlevels/stats/">Statistics Overview</a></li><li><a class="tocitem" href="../PairPlots/">PairPlots</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Orbits &amp; Emphemerides</a></li><li class="is-active"><a href>PlanetOrbits</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>PlanetOrbits</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaAstro/JuliaAstro.github.io/blob/master/docs/src/modules/PlanetOrbits/index.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><p>&lt;img height=150 src=&quot;docs/src/assets/logo.png&quot;/&gt;</p><h1 id="PlanetOrbits.jl"><a class="docs-heading-anchor" href="#PlanetOrbits.jl">PlanetOrbits.jl</a><a id="PlanetOrbits.jl-1"></a><a class="docs-heading-anchor-permalink" href="#PlanetOrbits.jl" title="Permalink"></a></h1><p><a href="https://sefffal.github.io/PlanetOrbits.jl/dev"><img src="https://img.shields.io/badge/docs-dev-blue.svg" alt/></a> <a href="https://codecov.io/gh/sefffal/PlanetOrbits.jl"><img src="https://codecov.io/gh/sefffal/PlanetOrbits.jl/branch/master/graph/badge.svg?token=QLTCBWVV98" alt="codecov"/></a></p><p>Tools for solving Keplerian orbits in the context of direct imaging. The primary use case is mapping Keplerian orbital elements into Cartesian coordinates at different times. A Plots.jl recipe is included for easily plotting orbits.</p><p>Among other values, it calculates the projected positions of planets, as well as stellar radial velocity and proper motion anomaly. It&#39;s a great tool for visualizing different orbits (see examples) and generating nice animations (e.g. with Plots or Luxor.jl).</p><p>This package has been designed for good performance and composability with a wide range of packages in the Julia ecosystem, including ForwardDiff. </p><p>To fit orbits to observations, see <a href="https://github.com/sefffal/DirectDetections.jl">DirectDetections.jl</a>.</p><h2 id="Usage"><a class="docs-heading-anchor" href="#Usage">Usage</a><a id="Usage-1"></a><a class="docs-heading-anchor-permalink" href="#Usage" title="Permalink"></a></h2><pre><code class="language-julia">using PlanetOrbits

# See below for units and conventions on these parameters.
elements = KeplerianElementsDeg(a=1, i=45, e=0.25, τ=0, M=1, ω=0, Ω=120, plx=35)

# Display one full period of the orbit (run `using Plots` first)
using Plots
plot(elements, label=&quot;My Planet&quot;)</code></pre><p><img src="docs/src/assets/orbit-sample.png" alt="Orbit Plot"/></p><p>Note that by default the horizontal axis is flipped to match how it would look in the sky. The horizontal coordinates generated by these functions are not flipped in this way. If you use these coordinates to sample an image, you will have to either flip the image or negate the <span>$x$</span> coordinate.</p><p>If you have an array of hundreds or thousands of orbits you want to visualize, just pass that array to <code>plot</code>. The opacity of the orbits will be reduced an appropriate amount.</p><p>Get projected cartesian coordinates in milliarcseconds at a given epoch:</p><pre><code class="language-julia">julia&gt; soln = orbitsolve(elements, 1.0) # at t time in modified julian days 
julia&gt; raoff(soln) # Access components of the solution
julia&gt; raoff(elements, 1.0) # Or compute just one component directly</code></pre><p>There are many convenience functions, including:</p><ul><li><code>period(elements)</code>:  period of a the companion in days.</li><li><code>distance(elements)</code>:  distance to the system in pc</li><li><code>meanmotion(elements)</code>: mean motion about the primary in radians/yr</li><li><code>projectedseparation(elements, t)</code>: given orbital elements and a time, the projected separation between the primary and companion</li><li><code>raoff(elements, t)</code>: as above, but only the offset in Right Ascension (milliarcseconds)</li><li><code>decoff(elements, t)</code>: as above, but only the offset in declination (milliarcseconds)</li><li><code>radvel</code>: radial velocity in m/s of the planet or star (see docstring)</li><li><code>propmotionanom</code>: proper motion anomaly of the star due to the planet in milliarseconds / year</li></ul><p>Showing an orbital elements object at the REPL will print a useful summary like this:</p><pre><code class="language-julia">julia&gt; elements
KeplerianElements{Float64}
─────────────────────────
a   [au ] = 1.0
i   [°  ] = 45.0
e         = 0.25
τ         = 0.0
M   [M⊙ ] = 1.0
ω   [°  ] = 0.0
Ω   [°  ] = 120.0
plx [mas] = 35.0
──────────────────────────
period      [yrs ] : 1.0
distance    [pc  ] : 28.6
mean motion [°/yr] : 360.0</code></pre><h2 id="Units-and-Conventions"><a class="docs-heading-anchor" href="#Units-and-Conventions">Units &amp; Conventions</a><a id="Units-and-Conventions-1"></a><a class="docs-heading-anchor-permalink" href="#Units-and-Conventions" title="Permalink"></a></h2><p>The main constructor, <code>KeplerianElements</code>, accepts the following parameters:</p><ul><li><code>a</code>: Semi-major axis in astronomical units (AU)</li><li><code>i</code>: Inclination in radians</li><li><code>e</code>: Eccentricity in the range [0, 1)</li><li><code>τ</code>: Epoch of periastron passage, in fraction of orbit [0,1]</li><li><code>M</code>: Graviataion parameter of the central body, expressed in units of Solar mass.</li><li><code>ω</code>: Argument of periastron</li><li><code>Ω</code>: Longitude of the ascending node, radians.</li><li><code>plx</code>: Distance to the system expressed in milliarcseconds of parallax.</li></ul><p>Thee parameter <code>τ</code> represents the epoch of periastron passage as a  fraction of the planet&#39;s orbit between 0 and 1. This follows the same convention as Orbitize! and you can read more about their choice in ther FAQ.</p><p>Parameters can either be specified by position or as keyword arguments (but not a mix). Positional  arguments are recommended if you are creating objects in a tight loop.</p><p>There is also a convenience constructor <code>KeplerianElementsDeg</code> that accepts <code>i</code>, <code>ω</code>, and <code>Ω</code> in units of degrees instead of radians.</p><p>See <a href="https://upload.wikimedia.org/wikipedia/commons/thumb/e/eb/Orbit1.svg/1110px-Orbit1.svg.png">this diagram</a> from Wikipedia as a reference for the conventions used by this package (note ♈︎ is replaced by the celestial North pole). &lt;!– </p><h2 id="Image-Warping"><a class="docs-heading-anchor" href="#Image-Warping">Image Warping</a><a id="Image-Warping-1"></a><a class="docs-heading-anchor-permalink" href="#Image-Warping" title="Permalink"></a></h2><p>If you have an image of a system, you can warp the image as if each pixel were a test particle following Kepler&#39;s laws.  This is an easy way to see what a disk or a system of planets would look like at a time other than when it was captured.</p><p>To make this possible, PlanetOrbits.jl can create <code>OrbitalTransformation</code> objects. These follow the conventions set out in CoordinateTransformations.jl and are compatible with ImageTransformations.jl.</p><p>Example:</p><pre><code class="language-julia">ot = OrbitalTransformation(
    i = 0.3,
    e = 0.1,
    M = 1.0,
    ω = 0.5,
    Ω = 0.5,
    plx = 30.0,
    
    platescale=10.0, # mas/px
    dt = 3*365.25 # days forward in time
)

img_centered = centered(img)
img_future = warp(img_centered, ot, axes(i))

# Display with DirectImages.jl
using DirectImages
imshow2([img; img_future], clims=(0,1), cmap=:seaborn_icefire_gradient)</code></pre><p><strong>Before, and After Orbital Transformation</strong>&lt;br&gt; <img src="https://user-images.githubusercontent.com/7330605/129625363-c0295432-47f4-4400-a5a7-7140a7e7d997.png" alt="image"/></p><p>Note the arguments <code>platescale</code> and <code>dt</code> are required, but <code>a</code> and <code>τ</code> are not. The position of the pixel in X/Y space uniquely determines the semi-major axis and epoch of periastron passage when the rest of the orbital parameters are known. <code>platescale</code> in units of milliarseconds/pixel is necessary to get the overall scale of the transform correct. This is because an orbital transformation is <strong>not</strong> linear (and therefore, care must be taken when composing an OrbitalTransformation with other CoordinateTransformations). Scaling an image will change the amount of rotation that occurs at each separation. <code>dt</code> is the the amount of time in days to project the image forward. It can also be negative to project the image into the past.   –&gt;</p><h2 id="Makie-Recipe"><a class="docs-heading-anchor" href="#Makie-Recipe">Makie Recipe</a><a id="Makie-Recipe-1"></a><a class="docs-heading-anchor-permalink" href="#Makie-Recipe" title="Permalink"></a></h2><p>There is a basic Makie plot recipe that allows you to plot a KeplerianElements:</p><pre><code class="language-julia">using CairoMakie
elements = KeplerianElementsDeg(a=1, i=45, e=0.25, τ=0, M=1, ω=0, Ω=120, plx=35)
lines(elements, axis=(;autolimitaspect=1, xreversed=true))</code></pre><p>Note that for Makie, you will have to reverse the x-axis manually whereas in Plots.jl it is set automatically.</p><h2 id="Installation"><a class="docs-heading-anchor" href="#Installation">Installation</a><a id="Installation-1"></a><a class="docs-heading-anchor-permalink" href="#Installation" title="Permalink"></a></h2><p>This package is not in the General registery, but a personal registry for this and related packages. To install it, first add the DirectRegistry containing this, and other related packages:</p><p>(<code>]</code> to enter Pkg mode)</p><pre><code class="language-julia"> pkg&gt; registry add https://github.com/sefffal/DirectRegistry
 pkg&gt; add PlanetOrbits</code></pre><p>That&#39;s it! If you want to run it through a gauntlet of tests, type <code>]</code> followed by <code>test PlanetOrbits</code></p><h2 id="Performance"><a class="docs-heading-anchor" href="#Performance">Performance</a><a id="Performance-1"></a><a class="docs-heading-anchor-permalink" href="#Performance" title="Permalink"></a></h2><p>On my 2017 Core i7 laptop, this library is able to calculate a projected position from a set of orbital elements in just 48ns (circular orbit) or 166ns (eccentric).</p><p>All the helper functions should work without any heap allocations when using standard numeric types.</p><p>Several parameters are pre-calculated when creating a KeplerianElements object. There is therefore a slight advantage to re-use the same object if you are sampling many positions from the same orbital elements (but we are only talking nanoseconds either way).</p><h2 id="Numerical-Derivatives"><a class="docs-heading-anchor" href="#Numerical-Derivatives">Numerical Derivatives</a><a id="Numerical-Derivatives-1"></a><a class="docs-heading-anchor-permalink" href="#Numerical-Derivatives" title="Permalink"></a></h2><p>This package works well with the autodiff package ForwardDiff.jl. For example:</p><pre><code class="language-julia">using ForwardDiff
ForwardDiff.derivative(t -&gt; radvel(elements, t), 123.0)</code></pre><p>This has only a negligible overhead (maybe 15%) compared to calculating the value itself. If you need access to both the value and the derivative, I recommend you use the DiffResults package to calculate both at once for a 2x speedup:</p><pre><code class="language-julia">using DiffResults
g = let elements=elements
    t -&gt; raoff(elements, t)
end

# Set the result type
result_out = DiffResults.DiffResult(1.0,1.0)

# Calculate both the value and derivative at once
@btime res = ForwardDiff.derivative!($result_out, $g, 1.0)
#  205.487 ns (0 allocations: 0 bytes)

# Access each
rv = DiffResults.value(res)
drvdt = DiffResults.derivative(res, Val{1})</code></pre><p>The Zygote reverse diff package does not currently work with PlanetOrbits.jl. &lt;!– </p><h2 id="Calculating-orbits-on-a-GPU"><a class="docs-heading-anchor" href="#Calculating-orbits-on-a-GPU">Calculating orbits on a GPU</a><a id="Calculating-orbits-on-a-GPU-1"></a><a class="docs-heading-anchor-permalink" href="#Calculating-orbits-on-a-GPU" title="Permalink"></a></h2><p>Using the CUDA and StructArray packages, you can easily calculate ensembles of orbits on the GPU.</p><p>For example:</p><pre><code class="language-julia">using PlanetOrbits
using StructArrays
using CUDA

# Create a vector of different initial conditions
elements = [KeplerianElementsDeg(
    a=1.0,
    i=45.,
    e=0.1,
    τ=0,
    ω=20,
    Ω=10,
    plx=50,
    M=3.0,
) for a in 1:0.01:10000]

# Convert the storage to a struct array instead of array of structs.
elements_sa = StructArray(elements)
# Send to GPU
elements_cusa = replace_storage(CuArray, elements_sa)

# Allocate output storage
out = zeros(length(elements_sa)) # CPU
out_cu = CUDA.zeros(length(elements_cusa)) # GPU

# Calculate the radial velocity of each orbit at time zero
@time            out .= radvel.(elements_sa, 0.0) # CPU
@time CUDA.@sync out_cu .= radvel.(elements_cusa, 0.0) # GPU</code></pre><p>On my laptop&#39;s pitiful GPU, the timing for the GPU calculation is still 17 times faster than on the CPU. –&gt;</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../highlevels/orb-ephem/">« Orbits &amp; Ephemerides Overview</a><a class="docs-footer-nextpage" href="../../highlevels/numerical-utils/">Numerical Utilities Overview »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 8 August 2022 15:51">Monday 8 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
