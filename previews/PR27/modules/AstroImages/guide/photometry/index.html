<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Photometry · JuliaAstro</title><script data-outdated-warner src="../../../../assets/warner.js"></script><link rel="canonical" href="https://juliaastro.github.io/modules/AstroImages/guide/photometry/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="JuliaAstro logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">JuliaAstro</a></span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../../../tutorials/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-2-2" type="checkbox"/><label class="tocitem" for="menuitem-2-2"><span class="docs-label">General</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../tutorials/jwst-image-scale-bar/">JWST image with scale bar</a></li><li><a class="tocitem" href="../../../../tutorials/tabular-data/">Working with tabular data</a></li><li><a class="tocitem" href="../../../../tutorials/curve-fit/">Curve Fitting</a></li></ul></li></ul></li><li><span class="tocitem">Time, Coordinates, &amp; Units</span><ul><li><a class="tocitem" href="../../../../highlevels/timecoords/">Time, Coordinates, &amp; Units Overview</a></li><li><a class="tocitem" href="../../../AstroAngles/">AstroAngles</a></li></ul></li><li><span class="tocitem">Images</span><ul><li><a class="tocitem" href="../../../../highlevels/images/">Images Overview</a></li></ul></li><li><span class="tocitem">Data I/O</span><ul><li><a class="tocitem" href="../../../../highlevels/dataio/">Data I/O Overview</a></li><li><a class="tocitem" href="../../../CasaCore/">CasaCore</a></li><li><a class="tocitem" href="../../../OIFITS/">OIFITS</a></li><li><a class="tocitem" href="../../../VLBIData/">VLBIData</a></li><li><a class="tocitem" href="../../../Difmap/">Difmap</a></li></ul></li><li><span class="tocitem">Cosmology</span><ul><li><a class="tocitem" href="../../../../highlevels/cosmology/">Cosmology Overview</a></li></ul></li><li><span class="tocitem">Orbits &amp; Emphemerides</span><ul><li><a class="tocitem" href="../../../../highlevels/orb-ephem/">Orbits &amp; Ephemerides Overview</a></li><li><a class="tocitem" href="../../../PlanetOrbits/">PlanetOrbits</a></li></ul></li><li><span class="tocitem">Numerical Utilities</span><ul><li><a class="tocitem" href="../../../../highlevels/numerical-utils/">Numerical Utilities Overview</a></li><li><a class="tocitem" href="../../../FFTW/">FFTW</a></li></ul></li><li><span class="tocitem">Statistics</span><ul><li><a class="tocitem" href="../../../../highlevels/stats/">Statistics Overview</a></li><li><a class="tocitem" href="../../../PairPlots/">PairPlots</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Photometry</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Photometry</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaAstro/JuliaAstro.github.io/blob/source/docs/src/modules/AstroImages/guide/photometry.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Photometry"><a class="docs-heading-anchor" href="#Photometry">Photometry</a><a id="Photometry-1"></a><a class="docs-heading-anchor-permalink" href="#Photometry" title="Permalink"></a></h1><p>The following examples are adapted from <a href="https://github.com/JuliaAstro/Photometry.jl/">Photometry.jl</a> to show the same examples combined with AstroImages.jl. To learn how to measure background levels, perform aperture photometry, etc see the <a href="https://juliaastro.github.io/Photometry.jl/dev/">Photometry.jl documentation</a>.</p><h2 id="Background-Estimation"><a class="docs-heading-anchor" href="#Background-Estimation">Background Estimation</a><a id="Background-Estimation-1"></a><a class="docs-heading-anchor-permalink" href="#Background-Estimation" title="Permalink"></a></h2><p>From Photometry.jl:</p><blockquote><p>Estimating backgrounds is an important step in performing photometry. Ideally, we could perfectly describe the background with a scalar value or with some distribution. Unfortunately, it&#39;s impossible for us to precisely separate the background and foreground signals. Here, we use mixture of robust statistical estimators and meshing to let us get the spatially varying background from an astronomical photo. Let&#39;s show an example Now let&#39;s try and estimate the background using estimate_background. First, we&#39;ll si gma-clip to try and remove the signals from the stars. Then, the background is broken down into boxes, in this case of size (50, 50). Within each box, the given statistical estimators get the background value and RMS. By default, we use SourceExtractorBackground and StdRMS. This creates a low-resolution image, which we then need to resize. We can accomplish this using an interpolator, by default a cubic-spline interpolator via ZoomInterpolator. The end result is a smooth estimate of the spatially varying background and background RMS.</p></blockquote><pre><code class="language- hljs">using Photometry
using AstroImages
using Plots # optional, for implot functionality

# Download our image, courtesy of astropy
image = AstroImage(download(&quot;https://rawcdn.githack.com/astropy/photutils-datasets/8c97b4fa3a6c9e6ea072faeed2d49a20585658ba/data/M6707HH.fits&quot;))

# sigma-clip
clipped = sigma_clip(image, 1, fill=NaN)

# get background and background rms with box-size (50, 50)
bkg, bkg_rms = estimate_background(clipped, 50)

imview(image)
imview(clipped)
imview(bkg)
imview(bkg_rms)</code></pre><p>Or, if you have Plots loaded:</p><pre><code class="language- hljs">using Plots

    AstroImages.set_clims!(Percent(99.5))
    AstroImages.set_cmap!(:magma)
    AstroImages.set_stretch!(identity)
plot(
    implot(image, title=&quot;Original&quot;),
    implot(clipped, title=&quot;Sigma-Clipped&quot;),
    implot(bkg, title=&quot;Background&quot;),
    implot(bkg_rms, title=&quot;Background RMS&quot;),
    layout=(2, 2)
)</code></pre><p><img src="/assets/manual-photometry-2.png" alt/></p><blockquote><p>We could apply a median filter, too, by specifying filter_size</p></blockquote><pre><code class="language- hljs"># get background and background rms with box-size (50, 50) and filter_size (5, 5)
bkg_f, bkg_rms_f = estimate_background(clipped, 50, filter_size=5)

# plot
plot(
    implot(bkg, title=&quot;Unfiltered&quot;, ylabel=&quot;Background&quot;),
    implot(bkg_f, title=&quot;Filtered&quot;),
    implot(bkg_rms, ylabel=&quot;RMS&quot;),
    implot(bkg_rms_f);
    layout=(2, 2),)</code></pre><blockquote><p>Now we can see our image after subtracting the filtered background and ready for Aperture Photometry!</p></blockquote><pre><code class="language- hljs">subt = image .- bkg_f[axes(image)...]
clims = extrema(vcat(vec(image), vec(subt)))
plot(
    implot(image; title=&quot;Original&quot;, clims),
    implot(subt; title=&quot;Subtracted&quot;, clims),
    size=(1600,1000)
)</code></pre><h2 id="Source-Extraction"><a class="docs-heading-anchor" href="#Source-Extraction">Source Extraction</a><a id="Source-Extraction-1"></a><a class="docs-heading-anchor-permalink" href="#Source-Extraction" title="Permalink"></a></h2><p>From the background-subtracted image, we can detect all sources in the image:</p><pre><code class="language- hljs"># We specify the uncertainty in the pixel data. We&#39;ll set it equal to zero.
errs = zeros(axes(subt))
sources = extract_sources(PeakMesh(), subt, errs, true) # sort from brightest to darkest</code></pre><p>There&#39;s over 60,000 sources!</p><p>We&#39;ll define a circular apperture for each source:</p><pre><code class="language- hljs">aps = CircularAperture.(sources.x, sources.y, 6)[1:1000] # just brightest thousand point sources</code></pre><p>We can overplot them on our original image. The coordinate sytem used by the Photometry.jl plot recipes (but not the actual return values) doesn&#39;t match AstroImages, so we must transpose our image:</p><pre><code class="language- hljs">implot(subt&#39;, colorbar=false)
plot!(aps) </code></pre><h2 id="Measuring-Photometry"><a class="docs-heading-anchor" href="#Measuring-Photometry">Measuring Photometry</a><a id="Measuring-Photometry-1"></a><a class="docs-heading-anchor-permalink" href="#Measuring-Photometry" title="Permalink"></a></h2><p>Finally we can extract the source photometry </p><pre><code class="language- hljs">table = photometry(aps, subt)</code></pre><p>And plot them: </p><pre><code class="language- hljs">scatter(
    table.xcenter,
    table.ycenter,
    aspectratio=1,
    marker_z=table.aperture_sum,
    markerstrokewidth=0,
    label=&quot;&quot;,
    framestyle=:box,
    background_inside=:black,
    color=:white
)</code></pre></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.22 on <span class="colophon-date" title="Friday 5 August 2022 20:48">Friday 5 August 2022</span>. Using Julia version 1.7.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
